
  <head>
    <title>Human Circuit</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
  </head>
  <body>
    <div class="container">
      <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#intro">Intro</a></li>
        <li><a data-toggle="tab" href="#equipment">Equipment</a></li>
        <li><a data-toggle="tab" href="#basics">Basics</a></li>
        <li><a data-toggle="tab" href="#e1">Wires</a></li>
        <li><a data-toggle="tab" href="#boolean">Boolean</a></li>
        <li><a data-toggle="tab" href="#not">NOT</a></li>
        <li><a data-toggle="tab" href="#e2">NOT exercise</a></li>
        <li><a data-toggle="tab" href="#or">OR</a></li>
        <li><a data-toggle="tab" href="#e3">OR exercise</a></li>
        <li><a data-toggle="tab" href="#and">AND</a></li>
        <li><a data-toggle="tab" href="#e4">AND exercise</a></li>
        <li><a data-toggle="tab" href="#eor">XOR</a></li>
        <li><a data-toggle="tab" href="#e5">XOR exercise</a></li>
        <li><a data-toggle="tab" href="#e6">1-bit half-adder exercise</a></li>
      </ul>

      <div class="tab-content">
        <div id="intro" class="tab-pane fade in active">
          <div class="jumbotron">
            <h1>Human Computer</h1>
            <p class="lead">We will introduce how to make digital logic circuits and interactively implement in real-life by having every person act as a logic "gate".</p>
          </div>
          <h2>Please sit as follows</h2>
          <p><div id="map_group" class="simcir"></div></p>
        </div>
        <div id="equipment" class="tab-pane fade">
          <h2>Hats</h2>
          <h3>Blue Hat: off, zero, 0, LOW</h3>
          <img class="img-responsive" src="blue-hat.jpg">
          <h3>Gold Hat: on, one, 1, HIGH</h3>
          <img class="img-responsive" src="gold-hat.jpg">
          <h3>Bib: your numbered identifier (wear with number in back)</h3>
          <img class="img-responsive" src="bib.jpg">
        </div>
        <div id="boolean" class="tab-pane fade">
            <h3>Boolean truth table</h3>
              <p>A logic gate is an elementary building block of a digital circuit. Most logic gates have two inputs and one output. At any given moment, every terminal is in one of the two binary conditions low (0) or high (1), represented by different voltage levels.</p>
            <p>
            <img class="img-responsive" src="boolean_table.jpg">
            </p>
           <h3>Logic gate</h3>
            <p>A logic gate is an elementary building block of a digital circuit. Most logic gates have two inputs and one output. At any given moment, every terminal is in one of the two binary conditions low (0) or high (1), represented by different voltage levels.
            </p>
        </div>

        <div id="basics" class="tab-pane fade">
          <h3>Simplest circuit</h3>
          <p>Just turn on the led!</p>
          <p>
          Uses the following: 
          <ul>
          <li>DC: source of "electricity", in this case, the instructor</li>
          <li>IN: input to the circuit, can be toggled between TRUE/FALSE, 0/1</li>
          <li>OUT: output of the circuit, lits up if the input is 1, off with 0</li>
          </ul>
          </p>

          <p><div id="circuit_sample" class="simcir"></div></p>
          <p>A wire</p>
          <p><div id="wire_sample" class="simcir"></div></p>
        </div>

        <div id="not" class="tab-pane fade">
          <h3>NOT logic gate</h3>
          <p>In digital logic, an inverter or NOT gate is a logic gate which implements logical negation. The truth table is shown here.</p>
          <table class="table table-condensed" align="right">
          <tbody><tr bgcolor="#DDEEFF" align="center">
          <td><b>INPUT</b></td>
          <td><b>OUTPUT</b></td>
          </tr>
          <tr bgcolor="#DDEEFF" align="center">
          <td>A</td>
          <td>NOT A</td>
          </tr>
          <tr bgcolor="#DDFFDD" align="center">
          <td>0</td>
          <td>1</td>
          </tr>
          <tr bgcolor="#DDFFDD" align="center">
          <td>1</td>
          <td>0</td>
          </tr>
          </tbody></table>
          <p><div id="not_sample" class="simcir"></div></p>
        </div>

        <div id="or" class="tab-pane fade">
          <h3>OR logic gate</h3>
          <p>The OR gate is a digital logic gate that implements logical disjunction - it behaves according to the truth table to the right. A HIGH output (1) results if one or both the inputs to the gate are HIGH (1). If neither input is high, a LOW output (0) results.</p>
          <table class="table" style="float:right;">
          <tbody><tr style="background:#def; text-align:center;">
          <td colspan="2"><b>INPUT</b></td>
          <td><b>OUTPUT</b></td>
          </tr>
          <tr bgcolor="#DDEEFF" align="center">
          <td>A</td>
          <td>B</td>
          <td>A OR B</td>
          </tr>
          <tr style="background:#dfd; text-align:center;">
          <td>0</td>
          <td>0</td>
          <td>0</td>
          </tr>
          <tr style="background:#dfd; text-align:center;">
          <td>0</td>
          <td>1</td>
          <td>1</td>
          </tr>
          <tr style="background:#dfd; text-align:center;">
          <td>1</td>
          <td>0</td>
          <td>1</td>
          </tr>
          <tr style="background:#dfd; text-align:center;">
          <td>1</td>
          <td>1</td>
          <td>1</td>
          </tr>
          </tbody></table>
          <p>
          <div id="or_sample" class="simcir"></div></p>
        </div>

        <div id="and" class="tab-pane fade">
          <h3>AND logic gate</h3>
          <p><img class="img-responsive pull-right" src="and.png"></p>
          <p><div id="and_sample" class="simcir"></div></p>
        </div>

        <div id="eor" class="tab-pane fade">
          <h3>XOR logic gate</h3>
          <p><img class="img-responsive pull-right" src="eor.png"></p>
          <p><div id="eor_sample" class="simcir"></div></p>
        </div>

        <div id="e1" class="tab-pane fade">
          <h3>Wire</h3>
          <p>WIRE: just copy the input to the output (acts as a wire)</p>
          <p><div id="exercise1" class="simcir"></div></p>
        </div>

        <div id="e2" class="tab-pane fade">
          <h3>NOT</h3>
          <p>NOT: output of the circuit, lits up if the input is 1, off with 0</p>
          <p><img class="img-responsive pull-right" src="not.png"></p>
          <p><div id="exercise2" class="simcir"></div></p>
        </div>

        <div id="e3" class="tab-pane fade">
          <h3>OR</h3>
          <p><img class="img-responsive pull-right" src="or.png"></p>
          <p><div id="exercise3" class="simcir"></div></p>
        </div>

        <div id="e4" class="tab-pane fade">
          <h3>AND</h3>
          <p><img class="img-responsive pull-right" src="and.png"></p>
          <p><div id="exercise4" class="simcir"></div></p>
        </div>

        <div id="e5" class="tab-pane fade">
          <h3>Exclusive OR (XOR)</h3>
          <p><img class="img-responsive pull-right" src="eor.png"></p>
          <p><div id="exercise5" class="simcir"></div></p>
        </div>
        <div id="e6" class="tab-pane fade">
          <h3>1-Bit Half-Adder</h3>
          <p><div id="exercise6" class="simcir"></div></p>
        </div>
      </div>
    </div>
    <script>

    // parameters
    var config = {}; // { "gates": 0, "seats": 0, "rows": 0, "xoffset": 0, "yoffset": 0};
    config.gates = 32;
    config.seats = 8;
    XOFFSET = 152 - 96;
    YOFFSET = 128 - 80;
    config.xoffset = XOFFSET;
    config.yoffset = YOFFSET;

    function dc_gate(config) {
      return { 
        "type": "DC",
        "id": "dev0",
        "x": config.xoffset,
        "y": config.yoffset*((config.seats/2)),
        "label": "DC"
      }
    }

    function in_gate(id, xs, ys) {
      return { 
              "type":"Toggle",
              "id": "dev" + id, 
              "x":xs,
              "y":ys,
              "label":"IN " + id
            }
    }

    function out_gate(id, xs, ys) {
      return {"type":"LED","id": "dev" + id, "x":xs,"y":ys,"label":"OUT " + id}
    }

    function connect_single(src, dest) {
      return {"from":"dev" + src + ".out0","to": "dev" + dest + ".in0"}
    }

    function add_gate_connectors(g, devices, connectors) {
        devices.push(g.device);
        Array.prototype.push.apply(connectors, g.connectors);
    }

    // variables
    function layout(config, gate) {
      var xs = config.xoffset;
      var ys = config.yoffset;
      var devices = [];
      var connectors = [];
      var it = {};

      config.rows = config.gates/config.seats;
  
      devices.push(dc_gate(config));
      xs += config.xoffset;

      for(i=1; i<=config.rows; i++) {
        for(j=1; j<=config.seats; j++) {
          id = (i-1)*(config.seats)+j;
          pid = (i-2)*(config.seats)+j;

          if(i==1) {
            devices.push(in_gate(id, xs, ys));
            connectors.push(connect_single(0, id));
          } else if(i==config.rows) {
            devices.push(out_gate(id, xs, ys));
            connectors.push(connect_single(pid, id));
          } else {
            var it = {
              "row": i,
              "seat": j,
              "xs": xs,
              "ys": ys,
              "id": id,
              "pid": pid
            };
            var g = gate(config, it);
            add_gate_connectors(g, devices, connectors);
          }
          ys += config.yoffset;
        }
        ys = config.yoffset;
        xs += config.xoffset;
      }

      var values = {
        "width": xoffset_from_config(config),
        "height": yoffset_from_config(config),
        "showToolbox": false,
        "devices": devices,
        "connectors": connectors
      };
      return values;
    }

    function map_group(config) {
      var xs = config.xoffset;
      var ys = config.yoffset;
      var devices = [];
      config.rows = config.gates/config.seats;
  
      devices.push({
        type: 'DC', 
        x: config.xoffset, 
        y: (config.seats/2)*config.yoffset, 
        label: "Instructor"
      });
      xs += config.xoffset;

      for(i=1; i<=config.rows; i++) {
        for(j=1; j<=config.seats; j++) {
          id = (i-1)*(config.seats)+j;
          devices.push({
            type: 'teacher', 
            x: xs, 
            y: ys, 
            label: "老师" + id
          });
          ys += config.yoffset;
        }
        ys = config.yoffset;
        xs += config.xoffset;
      }
      
      var values = {
        "width": xoffset_from_config(config),
        "height": yoffset_from_config(config),
        "showToolbox": false,
        "devices": devices,
        "connectors": []
      };
      return values;
    }

    function xoffset_from_config(config) {
      return config.rows*config.xoffset+2*config.xoffset;
    }

    function yoffset_from_config(config) {
      return config.seats*config.yoffset+2*config.yoffset
    }

    function layout_string(config, gate) {
      return JSON.stringify(layout(config, gate));
    }

    function dual_inputs(it, name, a, b) {
      if(name == 'EOR') {
        label = 'XOR';
      } else {
        label = name;
      }
      return {
        device: {
          "type": name, 
          "id": "dev" + it.id, 
          "x": it.xs,
          "y": it.ys,
          "label": label + " " + it.id
        },
        connectors: [
          {"from":"dev" + a + ".out0","to": "dev" + it.id + ".in0"},
          {"from":"dev" + b + ".out0","to": "dev" + it.id + ".in1"},
        ]
      }
    }

    function copy(it) {
      return {
        device: {"type":"BUF", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"WIRE " + it.id},
        connectors: [{"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"}]             
      }     
    }

    function not(it) {
      return {
        device: {"type":"NOT", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"NOT " + it.id},
        connectors: [{"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"}]             
      }     
    }

    function move_up(it) {
      return {
        device: {"type":"BUF", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"WIRE " + it.id},
        connectors: [{"from":"dev" + (it.pid+1) + ".out0","to": "dev" + it.id + ".in0"}]             
      }     
    }

    function wire_circuit(config, it) {
      return copy(it);
    }

    function not_circuit(config, it) {
      return {
        device: {"type":"NOT","id": "dev" + it.id, "x":it.xs,"y":it.ys,"label":"NOT " + it.id},
        connectors: [{"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"}]
      }
    }

    function and_circuit(config, it) {
      var offset;
      if((it.id % config.seats)==0) {
        offset = -1;
      } else {
        offset = 1;
      }
      return {
        device: {"type":"AND","id": "dev" + it.id, "x":it.xs,"y":it.ys,"label":"AND " + it.id},
        connectors: [
          {"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"},
          {"from":"dev" + (it.pid + offset) + ".out0","to": "dev" + it.id + ".in1"},
        ]
      }
    }

    function or_circuit(config, it) {
      var offset;
      if((id % config.seats)==0) {
        offset = -1;
      } else {
        offset = 1;
      }
      return {
        device: {"type":"OR","id": "dev" + it.id, "x":it.xs,"y":it.ys,"label":"OR " + it.id},
        connectors: [
          {"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"},
          {"from":"dev" + (it.pid + offset) + ".out0","to": "dev" + it.id + ".in1"},
        ]
      }
    }

    function eor_circuit(config, it) {
      var offset;
      if((id % config.seats)==0) {
        offset = -1;
      } else {
        offset = 1;
      }
      return {
        device: {"type":"EOR","id": "dev" + it.id, "x":it.xs,"y":it.ys,"label":"XOR " + it.id},
        connectors: [
          {"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"},
          {"from":"dev" + (it.pid + offset) + ".out0","to": "dev" + it.id + ".in1"},
        ]
      }
    }

    function halfadder_circuit(config, it) {
      var pair = it.pid + 1;
      var d;
      if(it.row == 2) {
        var a, b;
        if(it.id % 2) {
          a = it.pid;
          b = pair;
          d = {"type":"EOR", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"XOR " + it.id};
        } else {
          a = it.pid - 1;
          b = pair - 1;
          d = {"type":"AND", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"AND " + it.id};
        }
        return {
          device: d,
          connectors: [
            {"from":"dev" + a + ".out0","to": "dev" + it.id + ".in0"},
            {"from":"dev" + b + ".out0","to": "dev" + it.id + ".in1"},
          ]
        }        
      } else {
          return {
            device: {"type":"BUF", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"WIRE " + it.id},
            connectors: [{"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"}]             
          }       
      }
    }

    function fulladder_circuit(config, it) {
      // for row 2, alternate simple bit adders EOR/AND
      // from [3 to seats/2+1 (5)], 
      // from [1 to seats/2]
      //   BUF pid
      // from seats/2+1, XOR
      // from seats/2+2, AND
      // if seat==seats, OR(seats/2+2, pid+2)
      // else, BUF pid+1 or 0 if pid+1 > seats
      var pair = it.pid + 1;
      var d;
      if(it.row == 2) {
        var a, b;
        if(it.id % 2) {
          a = it.pid;
          b = pair;
          d = "EOR"
        } else {
          a = it.pid - 1;
          b = pair - 1;
          d = "AND"
        }
        return dual_inputs(it, d, a, b);      
      } else if(it.row == 3) {
        if(it.seat == 1) {
          return copy(it);
        } else if(it.seat == 2) {
          return dual_inputs(it, "EOR", it.pid, it.pid+1);
        } else if(it.seat == 3) {
          return dual_inputs(it, "AND", it.pid-1, it.pid);          
        } else if(it.seat == config.seats) {
          return dual_inputs(it, "OR", it.id-5, it.pid-4);                   
        } else {
          return move_up(it);
        }
      } else if(it.row == 4) {
        if(it.seat <= 2) {
          return copy(it);
        } else if(it.seat == 3) {
          return dual_inputs(it, "EOR", it.pid, it.pid+1);
        } else if(it.seat == 4) {
          return dual_inputs(it, "AND", it.pid-1, it.pid);          
        } else if(it.seat == config.seats) {
          return dual_inputs(it, "OR", it.id-4, it.pid-3);                   
        } else {
          return move_up(it);
        }
      } else if(it.row == 5) {
        if(it.seat <= 3) {
          return copy(it);
        } else if(it.seat == 4) {
          return dual_inputs(it, "EOR", it.pid, it.pid+1);
        } else if(it.seat == 5) {
          return dual_inputs(it, "AND", it.pid-1, it.pid);          
        } else if(it.seat == config.seats) {
          return dual_inputs(it, "OR", it.id-4, it.pid-3);                   
        } else {
          return move_up(it);
        }
      } else {
        return copy(it);
      }
    }

    var sample1_config = {seats: 1, gates: 2, xoffset: XOFFSET, yoffset: YOFFSET}
    var sample2_config = {seats: 1, gates: 3, xoffset: XOFFSET, yoffset: YOFFSET}
    var sample3_config = {sample: true, seats: 1, gates: 3, xoffset: XOFFSET, yoffset: YOFFSET}

    function pair_layout_string(name) {
      var devices = [];
      var connectors = [];
      var config = {seats: 2, gates: 3, rows: 3, xoffset: XOFFSET, yoffset: YOFFSET}

      devices.push(dc_gate(config));
      devices.push(in_gate(1, 2*XOFFSET, YOFFSET));
      devices.push(in_gate(2, 2*XOFFSET, 2*YOFFSET));
      connectors.push(connect_single(0, 1));
      connectors.push(connect_single(0, 2));

      var g = dual_inputs({xs: XOFFSET*3, ys: YOFFSET, id: 3}, name, 1, 2)
      add_gate_connectors(g, devices, connectors);
      devices.push(out_gate(4, XOFFSET*4, YOFFSET));
      connectors.push(connect_single(3, 4));
      var values = {
        "width": xoffset_from_config(config),
        "height": yoffset_from_config(config),
        "showToolbox": false,
        "devices": devices,
        "connectors": connectors
      };
      return JSON.stringify(values);    
    }

    $("#circuit_sample").text(layout_string(sample1_config, function() {}));
    $("#wire_sample").text(layout_string(sample2_config, function(config, it) {
      return copy(it);
    }));

    $("#not_sample").text(layout_string(sample2_config, function(config, it) {
      return not(it);
    }));

    $("#or_sample").text(pair_layout_string("OR"));
    $("#and_sample").text(pair_layout_string("AND"));
    $("#eor_sample").text(pair_layout_string("EOR"));

    $("#exercise1").text(layout_string(config, wire_circuit));
    $("#exercise2").text(layout_string(config, not_circuit));
    $("#exercise3").text(layout_string(config, or_circuit));
    $("#exercise4").text(layout_string(config, and_circuit));
    $("#exercise5").text(layout_string(config, eor_circuit));
    $("#exercise6").text(layout_string(config, halfadder_circuit));
    $("#map_group").text(JSON.stringify(map_group(config)));
    //$("#exercise6").text(JSON.stringify(layout(config, exercise6)));
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

<!-- Latest compiled and minified CSS 
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
-->
<!-- Optional theme
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">
 -->
<!-- Latest compiled and minified JavaScript 
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
--> 
  </body>
