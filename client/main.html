
  <head>
    <title>Human Circuit</title>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <title>something</title>

  </head>
  <body>
    <div id="exercise5" class="simcir"></div>
    <div id="exercise1" class="simcir"></div>
    <div id="exercise2" class="simcir"></div>
    <div id="exercise3" class="simcir"></div>
    <div id="exercise4" class="simcir"></div>
  <script>

    // parameters
    var config = {}; // { "gates": 0, "seats": 0, "rows": 0, "xoffset": 0, "yoffset": 0};
    config.gates = 64;
    config.seats = 8;
    config.rows = config.gates/config.seats;
    config.xoffset = 152 - 96;
    config.yoffset = 128 - 80;

    // variables
    function layout(config, gate) {
      var xs = config.xoffset;
      var ys = config.yoffset;
      var devices = [];
      var connectors = [];
      var it = {};

      devices.push({
        "type": "DC",
        "id": "dev0",
        "x": xs,
        "y": config.yoffset*(config.seats/2),
        "label": "DC"
      });
      xs += config.xoffset;

      for(i=1; i<=config.rows; i++) {
        for(j=1; j<=config.seats; j++) {
          id = (i-1)*(config.seats)+j;
          pid = (i-2)*(config.seats)+j;

          if(i==1) {
            devices.push({
              "type":"Toggle",
              "id": "dev" + id, 
              "x":xs,
              "y":ys,
              "label":"Toggle " + id
            });
            connectors.push({"from":"dev0.out0","to": "dev" + id + ".in0"});
          } else if(i==config.rows) {
            devices.push({"type":"LED","id": "dev" + id, "x":xs,"y":ys,"label":"LED " + id});
            connectors.push({"from":"dev" + pid + ".out0","to": "dev" + id + ".in0"});
          } else {
            var it = {
              "row": i,
              "seat": j,
              "xs": xs,
              "ys": ys,
              "id": id,
              "pid": pid
            };
            var g = gate(config, it);
            devices.push(g.device);
            Array.prototype.push.apply(connectors, g.connectors);
          }
          ys += config.yoffset;
        }
        ys = config.yoffset;
        xs += config.xoffset;
      }
      var values = {
        "width": config.rows*config.xoffset+2*config.xoffset,
        "height": config.seats*config.yoffset+2*config.yoffset,
        "showToolbox": false,
        "devices": devices,
        "connectors": connectors
      };
      return values;
    }

    function exercise1(config, it) {
      return {
        device: {"type":"NOT","id": "dev" + it.id, "x":it.xs,"y":it.ys,"label":"NOT " + it.id},
        connectors: [{"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"}]
      }
    }

    function exercise2(config, it) {
      var offset;
      if((it.id % config.seats)==0) {
        offset = -1;
      } else {
        offset = 1;
      }
      return {
        device: {"type":"AND","id": "dev" + it.id, "x":it.xs,"y":it.ys,"label":"AND " + it.id},
        connectors: [
          {"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"},
          {"from":"dev" + (it.pid + offset) + ".out0","to": "dev" + it.id + ".in1"},
        ]
      }
    }

    function exercise3(config, it) {
      var offset;
      if((id % config.seats)==0) {
        offset = -1;
      } else {
        offset = 1;
      }
      return {
        device: {"type":"OR","id": "dev" + it.id, "x":it.xs,"y":it.ys,"label":"OR " + it.id},
        connectors: [
          {"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"},
          {"from":"dev" + (it.pid + offset) + ".out0","to": "dev" + it.id + ".in1"},
        ]
      }
    }

    function exercise4(config, it) {
      var offset;
      if((id % config.seats)==0) {
        offset = -1;
      } else {
        offset = 1;
      }
      return {
        device: {"type":"EOR","id": "dev" + it.id, "x":it.xs,"y":it.ys,"label":"EOR " + it.id},
        connectors: [
          {"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"},
          {"from":"dev" + (it.pid + offset) + ".out0","to": "dev" + it.id + ".in1"},
        ]
      }
    }

    function exercise5(config, it) {
      var pair = it.pid + 1;
      var d;
      if(it.row == 3) {
        var a, b;
        if(it.id % 2) {
          a = it.pid;
          b = pair;
          d = {"type":"EOR", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"EOR " + it.id};
        } else {
          a = it.pid - 1;
          b = pair - 1;
          d = {"type":"AND", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"AND " + it.id};
        }
        return {
          device: d,
          connectors: [
            {"from":"dev" + a + ".out0","to": "dev" + it.id + ".in0"},
            {"from":"dev" + b + ".out0","to": "dev" + it.id + ".in1"},
          ]
        }        
      } else if(it.row == 2) {
        if((it.seat % 2) == 0) {
          src = (it.pid + 4) % config.seats;
          if(src == 0) src = 8;
        } else {
          src = it.pid;
        }
        return {
          device: {"type":"BUF", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"BUF " + it.id},
          connectors: [{"from":"dev" + src + ".out0","to": "dev" + it.id + ".in0"}]             
        }
      } else if(it.row == (config.rows - 1)) {
        if((it.seat % 2) == 0) {
          src = ((it.pid + 4) % config.seats);
          if(src == 0) { src = 8 };
          src += ((it.row-2)*config.seats);
        } else {
          src = it.pid;
        }
        return {
          device: {"type":"BUF", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"BUF " + it.id},
          connectors: [{"from":"dev" + src + ".out0","to": "dev" + it.id + ".in0"}]             
        }
      } else {
          return {
            device: {"type":"BUF", "id": "dev" + it.id, "x": it.xs,"y": it.ys,"label":"BUF " + it.id},
            connectors: [{"from":"dev" + it.pid + ".out0","to": "dev" + it.id + ".in0"}]             
          }       
      }
    }

    // $("#exercise1").text(JSON.stringify(layout(config, exercise1)));
    // $("#exercise2").text(JSON.stringify(layout(config, exercise2)));
    // $("#exercise3").text(JSON.stringify(layout(config, exercise3)));
    // $("#exercise4").text(JSON.stringify(layout(config, exercise4)));
    $("#exercise5").text(JSON.stringify(layout(config, exercise5)));
    </script>
  </body>
